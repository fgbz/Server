<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper  
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="phalaenopsis.common.dao.ISWAttachmentDao">

	<!-- 根据业务数据Id，获取对应附件集合 -->
	<select id="getAttachments" parameterType="string"
		resultType="phalaenopsis.common.entity.Attachment.Attachment">
		select * from SW_ATTACHMENT where  nvl(ISDELETE,0) <![CDATA[<]]> <![CDATA[>]]> 1 and bizid = #{bizID} ORDER BY uploadtime DESC
	</select>
	
		<!-- 移动端查询照片是否已经上传过一次 -->
	<select id="getAttachmentByBizIdAndFileName" resultType="phalaenopsis.common.entity.Attachment.Attachment">
		select * from SW_ATTACHMENT t where t.filename = #{fileName}  and  t.bizid = #{spotid}
	</select>

	<!-- 根据业务数据Id，获取对应附件集合 -->
	<select id="getMoblieAttachments" resultType="phalaenopsis.common.entity.Attachment.Attachment">
		select * from
		SW_ATTACHMENT where nvl(ISDELETE,0) <![CDATA[<]]> <![CDATA[>]]> 1 and  bizid = #{bizID} and SOURCE = #{source} and lower(fileext) in ('bmp', 'jpg','jpeg','png','gif') 
		and lower(fileext) in ('bmp', 'jpg','jpeg','png','gif')
	</select>

	<!-- 更新附件对应的业务数据 -->
	<update id="updateBizID" parameterType="string">   
		update SW_ATTACHMENT set bizid = #{bizID}, timing = sysdate
		<if test="exreaInfo != null and exreaInfo != '' ">
			, extrainfo = #{exreaInfo, javaType=String, jdbcType=CLOB}
		</if>
		<if test="module != null and module != '' ">
			, module = #{module}
		</if>
		where id=#{fileID}
	</update>

	<!-- 根据附件Id，获取附件对应的数据 -->
	<select id="getAttachmentById" parameterType="string"
		resultType="phalaenopsis.common.entity.Attachment.Attachment">
		select * from SW_ATTACHMENT where  id = #{fileID}
	</select>
	<!-- 批量删除附件(逻辑删除，实际上是做修改操作) -->
	<update id="batchUpdate" parameterType="java.util.List">
		update SW_ATTACHMENT set isdelete=1, timing = sysdate
		where id in
		 <foreach collection="ids" item="item" open="(" separator="," close=")">
		   		#{item}
		 </foreach>
	</update>
	<!-- 删除对应附件数据 -->
	<delete id="delete" parameterType="string">
		delete SW_ATTACHMENT where id
		= #{fileID}
	</delete>

	<insert id="save" parameterType="phalaenopsis.common.entity.Attachment.Attachment">
		insert into SW_ATTACHMENT(
		ID,
		FILENAME,
		FILEEXT,
		FILESIZE,
		ACTUALFILE,
		BIZID,
		THUMBFILE,
		EXPLAIN,
		UPLOADTIME,
		MODULE,
		SOURCE,
		X,
		Y,
		ANGLE,
		ISDELETE) values
		(#{id},
		#{fileName,jdbcType=VARCHAR},
		#{fileExt,jdbcType=VARCHAR},
		#{fileSize,jdbcType=INTEGER},
		#{actualFile,jdbcType=VARCHAR},
		#{bizID,jdbcType=VARCHAR},
		#{thumbFile,jdbcType=VARCHAR},
		#{explain,jdbcType=VARCHAR},
		#{uploadTime,jdbcType=TIMESTAMP},
		#{module,jdbcType=VARCHAR},
		#{source,jdbcType=VARCHAR},
		#{x,jdbcType=DOUBLE},
		#{y,jdbcType=DOUBLE},
		#{angle,jdbcType=DOUBLE},
		#{isdelete,jdbcType=INTEGER}
		)

	</insert>

</mapper>